<!DOCTYPE html>
<html lang="en" dir="ltr">
    <head><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content="In this post, we will take a look at Validation in YOLOv5. Table of Contents Validation Non-Maximum Suppression Profile Prediction Matrix AP, mAP Calculation Validation During training, validation is performed at the end of each epoch to evaluate the training of that epoch. 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 if RANK in {-1, 0}: # mAP callbacks.run(&#39;on_train_epoch_end&#39;, epoch=epoch) ema.update_attr(model, include=[&#39;yaml&#39;, &#39;nc&#39;, &#39;hyp&#39;, &#39;names&#39;, &#39;stride&#39;, &#39;class_weights&#39;]) final_epoch = (epoch + 1 == epochs) or stopper.">
<title>YOLOv5 Validation</title>

<link rel='canonical' href='https://kimberlykang.github.io/p/yolov5_val/'>

<link rel="stylesheet" href="/scss/style.min.663803bebe609202d5b39d848f2d7c2dc8b598a2d879efa079fa88893d29c49c.css"><meta property='og:title' content="YOLOv5 Validation">
<meta property='og:description' content="In this post, we will take a look at Validation in YOLOv5. Table of Contents Validation Non-Maximum Suppression Profile Prediction Matrix AP, mAP Calculation Validation During training, validation is performed at the end of each epoch to evaluate the training of that epoch. 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 if RANK in {-1, 0}: # mAP callbacks.run(&#39;on_train_epoch_end&#39;, epoch=epoch) ema.update_attr(model, include=[&#39;yaml&#39;, &#39;nc&#39;, &#39;hyp&#39;, &#39;names&#39;, &#39;stride&#39;, &#39;class_weights&#39;]) final_epoch = (epoch + 1 == epochs) or stopper.">
<meta property='og:url' content='https://kimberlykang.github.io/p/yolov5_val/'>
<meta property='og:site_name' content='Kimberly&#39;s Blog'>
<meta property='og:type' content='article'><meta property='article:section' content='Post' /><meta property='article:tag' content='YOLOv5' /><meta property='article:published_time' content='2023-03-29T00:20:00&#43;09:00'/><meta property='article:modified_time' content='2023-03-29T00:20:00&#43;09:00'/>
<meta name="twitter:title" content="YOLOv5 Validation">
<meta name="twitter:description" content="In this post, we will take a look at Validation in YOLOv5. Table of Contents Validation Non-Maximum Suppression Profile Prediction Matrix AP, mAP Calculation Validation During training, validation is performed at the end of each epoch to evaluate the training of that epoch. 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 if RANK in {-1, 0}: # mAP callbacks.run(&#39;on_train_epoch_end&#39;, epoch=epoch) ema.update_attr(model, include=[&#39;yaml&#39;, &#39;nc&#39;, &#39;hyp&#39;, &#39;names&#39;, &#39;stride&#39;, &#39;class_weights&#39;]) final_epoch = (epoch + 1 == epochs) or stopper."><style>
     
    :root {
        --article-font-family: "Open Sans", var(--base-font-family);
    }

     
    * {
        font-family: "Open Sans", var(--base-font-family);
    }

     
    *:lang(ko),
    *[lang="ko"],
    *[lang="ko-KR"],
    *[lang="ko-KP"] {
        font-family: "Nanum Gothic", var(--base-font-family);
    }

     
    *:lang(ko) *:not(:lang(ko)),
    *[lang="ko"] *:not([lang="ko"]),
    *[lang="ko-KR"] *:not([lang="ko-KR"]),
    *[lang="ko-KP"] *:not([lang="ko-KP"]) {
        font-family: "Open Sans", var(--base-font-family);
    }
</style>

<script>
    (function () {
        
        const nanumGothic = document.createElement('link');
        nanumGothic.href = "https://fonts.googleapis.com/css?family=Nanum+Gothic:400";
        nanumGothic.type = "text/css";
        nanumGothic.rel = "stylesheet";
        document.head.appendChild(nanumGothic);

        
        const openSans = document.createElement('link');
        openSans.href = "https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,300..800;1,300..800&display=swap";
        openSans.type = "text/css";
        openSans.rel = "stylesheet";
        document.head.appendChild(openSans);
    }());
</script>
    </head>
    <body class="
    article-page
    ">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            if(!localStorage.getItem(colorSchemeKey)){
                localStorage.setItem(colorSchemeKey, "auto");
            }
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky ">
    <button class="hamburger hamburger--spin" type="button" id="toggle-menu" aria-label="Toggle Menu">
        <span class="hamburger-box">
            <span class="hamburger-inner"></span>
        </span>
    </button>

    <header>
        
            
            <figure class="site-avatar">
                <a href="/">
                
                    
                    
                    
                        
                        <img src="/img/kimberly_avatar_hu92a1a2905f7ef83b94672016a24ef023_184760_300x0_resize_q75_box.jpeg" width="300"
                            height="300" class="site-logo" loading="lazy" alt="Avatar">
                    
                
                </a>
                
            </figure>
            
        
        
        <div class="site-meta">
            <h1 class="site-name"><a href="/">Kimberly&#39;s Blog</a></h1>
            <h2 class="site-description">Vision Engineer</h2>
        </div>
    </header><ol class="menu" id="main-menu">
        
        
        
        <li >
            <a href='/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <polyline points="5 12 3 12 12 3 21 12 19 12" />
  <path d="M5 12v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-7" />
  <path d="M9 21v-6a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v6" />
</svg>



                
                <span>Home</span>
            </a>
        </li>
        
        
        <li >
            <a href='/archives/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <rect x="3" y="4" width="18" height="4" rx="2" />
  <path d="M5 8v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-10" />
  <line x1="10" y1="12" x2="14" y2="12" />
</svg>



                
                <span>Archives</span>
            </a>
        </li>
        
        
        <li >
            <a href='/search/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="10" cy="10" r="7" />
  <line x1="21" y1="21" x2="15" y2="15" />
</svg>



                
                <span>Search</span>
            </a>
        </li>
        
        
        <li >
            <a href='/links/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M10 14a3.5 3.5 0 0 0 5 0l4 -4a3.5 3.5 0 0 0 -5 -5l-.5 .5" />
  <path d="M14 10a3.5 3.5 0 0 0 -5 0l-4 4a3.5 3.5 0 0 0 5 5l.5 -.5" />
</svg>



                
                <span>Links</span>
            </a>
        </li>
        
        <li class="menu-bottom-section">
            <ol class="menu">
                    
                        <li id="i18n-switch">  
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-language" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M4 5h7" />
  <path d="M9 3v2c0 4.418 -2.239 8 -5 8" />
  <path d="M5 9c-.003 2.144 2.952 3.908 6.7 4" />
  <path d="M12 20l4 -9l4 9" />
  <path d="M19.1 18h-6.2" />
</svg>



                            <select name="language" title="language" onchange="window.location.href = this.selectedOptions[0].value">
                                
                                    <option value="https://kimberlykang.github.io/" selected>English</option>
                                
                                    <option value="https://kimberlykang.github.io/ko/" >Korean</option>
                                
                            </select>
                        </li>
                    
                

                
                    <li id="dark-mode-toggle">
                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="8" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="16" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                        <span>Dark Mode</span>
                    </li>
                
            </ol>
        </li>
    </ol>
</aside>

    <aside class="sidebar right-sidebar sticky">
        
            
                
    <section class="widget archives">
        <div class="widget-icon">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <line x1="5" y1="9" x2="19" y2="9" />
  <line x1="5" y1="15" x2="19" y2="15" />
  <line x1="11" y1="4" x2="7" y2="20" />
  <line x1="17" y1="4" x2="13" y2="20" />
</svg>



        </div>
        <h2 class="widget-title section-title">Table of contents</h2>
        
        <div class="widget--toc">
            <nav id="TableOfContents">
  <ol>
    <li><a href="#validation">Validation</a></li>
    <li><a href="#non-maximum-suppression">Non-Maximum Suppression</a></li>
    <li><a href="#profile">Profile</a></li>
    <li><a href="#prediction-matrix">Prediction Matrix</a></li>
    <li><a href="#ap-map-calculation">AP, mAP Calculation</a></li>
  </ol>
</nav>
        </div>
    </section>

            
        
    </aside>


            <main class="main full-width">
    <article class="main-article">
    <header class="article-header">

    <div class="article-details">
    
    <header class="article-category">
        
            <a href="/categories/yolov5/" style="background-color: #2a9d8f; color: #fff;">
                YOLOv5
            </a>
        
    </header>
    

    <div class="article-title-wrapper">
        <h2 class="article-title">
            <a href="/p/yolov5_val/">YOLOv5 Validation</a>
        </h2>
    
        
    </div>

    
    
    
    
    <footer class="article-time">
        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4" />
  <circle cx="18" cy="18" r="4" />
  <path d="M15 3v4" />
  <path d="M7 3v4" />
  <path d="M3 11h16" />
  <path d="M18 16.496v1.504l1 1" />
</svg>
                <time class="article-time--published">Mar 29, 2023</time>
            </div>
        

        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



                <time class="article-time--reading">
                    6 minute read
                </time>
            </div>
        
    </footer>
    

    
        <footer class="article-translations">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-language" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M4 5h7" />
  <path d="M9 3v2c0 4.418 -2.239 8 -5 8" />
  <path d="M5 9c-.003 2.144 2.952 3.908 6.7 4" />
  <path d="M12 20l4 -9l4 9" />
  <path d="M19.1 18h-6.2" />
</svg>



            <div>
                
                    <a href="https://kimberlykang.github.io/ko/p/yolov5_val/" class="link">Korean</a>
                
            </div>
        </footer>
    
</div>

</header>

    <section class="article-content">
    
    
    <p>In this post, we will take a look at Validation in YOLOv5.</p>
<h1 id="table-of-contents">Table of Contents
</h1><ol>
<li><a class="link" href="#validation" >Validation</a></li>
<li><a class="link" href="#non-maximum-suppression" >Non-Maximum Suppression</a></li>
<li><a class="link" href="#profile" >Profile</a></li>
<li><a class="link" href="#prediction-matrix" >Prediction Matrix</a></li>
<li><a class="link" href="#ap-map-calculation" >AP, mAP Calculation</a></li>
</ol>
<h2 id="validation">Validation
</h2><p>During training, validation is performed at the end of each epoch to evaluate the training of that epoch.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">if</span> <span class="n">RANK</span> <span class="ow">in</span> <span class="p">{</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">}:</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># mAP</span>
</span></span><span class="line"><span class="cl">    <span class="n">callbacks</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="s1">&#39;on_train_epoch_end&#39;</span><span class="p">,</span> <span class="n">epoch</span><span class="o">=</span><span class="n">epoch</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">ema</span><span class="o">.</span><span class="n">update_attr</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;yaml&#39;</span><span class="p">,</span> <span class="s1">&#39;nc&#39;</span><span class="p">,</span> <span class="s1">&#39;hyp&#39;</span><span class="p">,</span> <span class="s1">&#39;names&#39;</span><span class="p">,</span> <span class="s1">&#39;stride&#39;</span><span class="p">,</span> <span class="s1">&#39;class_weights&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">    <span class="n">final_epoch</span> <span class="o">=</span> <span class="p">(</span><span class="n">epoch</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">==</span> <span class="n">epochs</span><span class="p">)</span> <span class="ow">or</span> <span class="n">stopper</span><span class="o">.</span><span class="n">possible_stop</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="ow">not</span> <span class="n">noval</span> <span class="ow">or</span> <span class="n">final_epoch</span><span class="p">:</span>  <span class="c1"># Calculate mAP</span>
</span></span><span class="line"><span class="cl">        <span class="n">results</span><span class="p">,</span> <span class="n">maps</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">validate</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">data_dict</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                        <span class="n">batch_size</span><span class="o">=</span><span class="n">batch_size</span> <span class="o">//</span> <span class="n">WORLD_SIZE</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                        <span class="n">imgsz</span><span class="o">=</span><span class="n">imgsz</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                        <span class="n">half</span><span class="o">=</span><span class="n">amp</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                        <span class="n">model</span><span class="o">=</span><span class="n">ema</span><span class="o">.</span><span class="n">ema</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                        <span class="n">single_cls</span><span class="o">=</span><span class="n">single_cls</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                        <span class="n">dataloader</span><span class="o">=</span><span class="n">val_loader</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                        <span class="n">save_dir</span><span class="o">=</span><span class="n">save_dir</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                        <span class="n">plots</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                        <span class="n">callbacks</span><span class="o">=</span><span class="n">callbacks</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                        <span class="n">compute_loss</span><span class="o">=</span><span class="n">compute_loss</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>In multi-GPU training, validation is performed only on <code>gpu 0</code>.</li>
<li>The parameters <code>conf_thres</code>, <code>iou_thres</code>, and <code>max_det</code> not explicitly specified above default to <code>conf_thres=0.001</code>, <code>iou_thres=0.6</code>, and <code>max_det=300</code>, and are later used in Non-Maximum Suppression (NMS).</li>
</ul>
<h2 id="non-maximum-suppression">Non-Maximum Suppression
</h2><ul>
<li>After performing inference on each validation data sample, Non-Maximum Suppression (NMS) is applied to the prediction results.</li>
<li>NMS is a method for removing duplicates among overlapping bounding boxes and selecting a single box. It selects the box to keep based on the bounding boxesâ€™ confidence scores and the IoU between boxes. Below is the code for calling NMS during validation.</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">with</span> <span class="n">dt</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl">    <span class="n">preds</span> <span class="o">=</span> <span class="n">non_max_suppression</span><span class="p">(</span><span class="n">preds</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                <span class="n">conf_thres</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                <span class="n">iou_thres</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                <span class="n">labels</span><span class="o">=</span><span class="n">lb</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                <span class="n">multi_label</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                <span class="n">agnostic</span><span class="o">=</span><span class="n">single_cls</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                <span class="n">max_det</span><span class="o">=</span><span class="n">max_det</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>The parameters <code>conf_thres</code>, <code>iou_thres</code>, and <code>max_det</code> used as arguments can have different values depending on where they are called.</li>
<li>When called in val.py:
<ul>
<li><code>conf_thres=0.001</code>: Any detection result with a confidence score less than 0.001 will be removed.</li>
<li><code>iou_thres=0.6</code>: For boxes with IoU greater than or equal to 0.6, only the one with the highest confidence score is selected.</li>
<li><code>max_det=300</code>: Among the remaining boxes, only the top 300 sorted by confidence score are returned.</li>
</ul>
</li>
<li>When called in detect.py:
<ul>
<li><code>conf_thres=0.25</code>, <code>iou_thres=0.45</code>, <code>max_det=1000</code> are used.</li>
</ul>
</li>
</ul>
<h2 id="profile">Profile
</h2><p>When <em><strong>non_max_suppression</strong></em> is called in val.py, it is wrapped with <code>with dt[2]</code>, where <code>dt</code> is an instance of the <code>Profile</code> class. To record the time taken for pre-processing, inference, and NMS, <code>Profile</code> objects are created before validation begins as shown below.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">dt</span> <span class="o">=</span> <span class="n">Profile</span><span class="p">(),</span> <span class="n">Profile</span><span class="p">(),</span> <span class="n">Profile</span><span class="p">()</span>  <span class="c1"># profiling times</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>The <code>Profile</code> class inherits from <code>contextlib.ContextDecorator</code>. A child class inheriting from <code>contextlib.ContextDecorator</code> can define actions to perform when entering a <code>with</code> block in the <em><strong>__enter__</strong></em> method, and actions to perform when exiting in the <em><strong>__exit__</strong></em> method. In <code>Profile</code>, the time is recorded upon entering and again upon exiting; the total time spent within the <code>with</code> block is saved in <code>self.t</code>.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Profile</span><span class="p">(</span><span class="n">contextlib</span><span class="o">.</span><span class="n">ContextDecorator</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># YOLOv5 Profile class. Usage: @Profile() decorator or &#39;with Profile():&#39; context manager</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="mf">0.0</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">t</span> <span class="o">=</span> <span class="n">t</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">cuda</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">is_available</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">start</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="bp">self</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">type</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">traceback</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">dt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span>  <span class="c1"># delta-time</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">t</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dt</span>  <span class="c1"># accumulate dt</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">time</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cuda</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">synchronize</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>If validation is not called during training, the average execution time is printed after validation as shown below.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># Print speeds</span>
</span></span><span class="line"><span class="cl"><span class="n">t</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">t</span> <span class="o">/</span> <span class="n">seen</span> <span class="o">*</span> <span class="mf">1E3</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">dt</span><span class="p">)</span>  <span class="c1"># speeds per image</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="ow">not</span> <span class="n">training</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">shape</span> <span class="o">=</span> <span class="p">(</span><span class="n">batch_size</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">imgsz</span><span class="p">,</span> <span class="n">imgsz</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Speed: %.1fms pre-process, %.1fms inference, %.1fms NMS per image at shape </span><span class="si">{</span><span class="n">shape</span><span class="si">}</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">t</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="prediction-matrix">Prediction Matrix
</h2><ul>
<li>After NMS, the results, labels, and desired IoU thresholds are passed to <em><strong>process_batch</strong></em>, which generates a Prediction Matrix that indicates, for each detection, whether an object was correctly detected.</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">correct</span> <span class="o">=</span> <span class="n">process_batch</span><span class="p">(</span><span class="n">predn</span><span class="p">,</span> <span class="n">labelsn</span><span class="p">,</span> <span class="n">iouv</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">process_batch</span><span class="p">(</span><span class="n">detections</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">iouv</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">    Return correct prediction matrix
</span></span></span><span class="line"><span class="cl"><span class="s2">    Arguments:
</span></span></span><span class="line"><span class="cl"><span class="s2">        detections (array[N, 6]), x1, y1, x2, y2, conf, class
</span></span></span><span class="line"><span class="cl"><span class="s2">        labels (array[M, 5]), class, x1, y1, x2, y2
</span></span></span><span class="line"><span class="cl"><span class="s2">    Returns:
</span></span></span><span class="line"><span class="cl"><span class="s2">        correct (array[N, 10]), for 10 IoU levels
</span></span></span><span class="line"><span class="cl"><span class="s2">    &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">correct</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">detections</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">iouv</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">bool</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">iou</span> <span class="o">=</span> <span class="n">box_iou</span><span class="p">(</span><span class="n">labels</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:],</span> <span class="n">detections</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">4</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">    <span class="n">correct_class</span> <span class="o">=</span> <span class="n">labels</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">detections</span><span class="p">[:,</span> <span class="mi">5</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">iouv</span><span class="p">)):</span>
</span></span><span class="line"><span class="cl">        <span class="n">x</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">iou</span> <span class="o">&gt;=</span> <span class="n">iouv</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">&amp;</span> <span class="n">correct_class</span><span class="p">)</span>  <span class="c1"># IoU &gt; threshold and classes match</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl">            <span class="n">matches</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">((</span><span class="n">torch</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">iou</span><span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]][:,</span> <span class="kc">None</span><span class="p">]),</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>  <span class="c1"># [label, detect, iou]</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">matches</span> <span class="o">=</span> <span class="n">matches</span><span class="p">[</span><span class="n">matches</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">argsort</span><span class="p">()[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
</span></span><span class="line"><span class="cl">                <span class="n">matches</span> <span class="o">=</span> <span class="n">matches</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">matches</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">return_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span><span class="mi">1</span><span class="p">]]</span>
</span></span><span class="line"><span class="cl">                <span class="c1"># matches = matches[matches[:, 2].argsort()[::-1]]</span>
</span></span><span class="line"><span class="cl">                <span class="n">matches</span> <span class="o">=</span> <span class="n">matches</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">matches</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">return_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span><span class="mi">1</span><span class="p">]]</span>
</span></span><span class="line"><span class="cl">            <span class="n">correct</span><span class="p">[</span><span class="n">matches</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">),</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">correct</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">bool</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">iouv</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>
<p><code>iouv</code> is the list of IOU threshold criteria.</p>
<ul>
<li>IoU thresholds from 0.5 to 0.95 are used.</li>
<li>tensor([0.50000, 0.55000, 0.60000, 0.65000, 0.70000, 0.75000, 0.80000, 0.85000, 0.90000, 0.95000], device=&lsquo;cuda:0&rsquo;)</li>
</ul>
</li>
<li>
<p><code>iou</code></p>
<ul>
<li>Calculates the IoU between the ground truth <code>labels</code> and the NMS results <code>detections</code>.</li>
<li>If there are 5 <code>labels</code> and 300 <code>detections</code>, the shape of <code>iou</code> will be (5, 300).</li>
</ul>
</li>
<li>
<p><code>matches</code></p>
<ul>
<li>Among detection results, selects those with IoU above the threshold and matching class.</li>
<li>Sorts by descending IoU.</li>
<li>Uses <em><strong>np.unique</strong></em> to remove duplicates in labels and detection results.</li>
<li>The shape is (number of matches, 3), where the three columns are label index, detection index, and IoU.</li>
<li>For example, the result filtered by IoU threshold and class may look like:
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="p">[[</span>          <span class="mi">1</span><span class="p">,</span>           <span class="mi">0</span><span class="p">,</span>     <span class="mf">0.51507</span><span class="p">],</span>
</span></span><span class="line"><span class="cl"><span class="p">[</span>          <span class="mi">1</span><span class="p">,</span>           <span class="mi">3</span><span class="p">,</span>     <span class="mf">0.78271</span><span class="p">],</span>
</span></span><span class="line"><span class="cl"><span class="p">[</span>          <span class="mi">1</span><span class="p">,</span>          <span class="mi">11</span><span class="p">,</span>     <span class="mf">0.51642</span><span class="p">],</span>
</span></span><span class="line"><span class="cl"><span class="p">[</span>          <span class="mi">1</span><span class="p">,</span>          <span class="mi">12</span><span class="p">,</span>     <span class="mf">0.54807</span><span class="p">]]</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>After removing duplicates, the result looks like:
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="p">[[</span>          <span class="mi">1</span><span class="p">,</span>           <span class="mi">0</span><span class="p">,</span>     <span class="mf">0.51507</span><span class="p">]]</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
</ul>
</li>
<li>
<p><code>correct</code></p>
<ul>
<li>For each detection, whether an object is found at each of 10 IoU thresholds.</li>
<li>If there are 300 detections, the shape is (300, 10).</li>
<li>For detections matched in <code>matches</code>, mark <code>True</code>, indicating the detection overlaps sufficiently with a ground truth label and is the correct class.</li>
</ul>
</li>
<li>
<p>The results of <em><strong>process_batch</strong></em> for all images are stored in <code>stats</code>.</p>
</li>
</ul>
<h2 id="ap-map-calculation">AP, mAP Calculation
</h2><ul>
<li>Using <em><strong>ap_per_class</strong></em>, precision, recall, and AP are calculated.</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">tp</span><span class="p">,</span> <span class="n">fp</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">f1</span><span class="p">,</span> <span class="n">ap</span><span class="p">,</span> <span class="n">ap_class</span> <span class="o">=</span> <span class="n">ap_per_class</span><span class="p">(</span><span class="o">*</span><span class="n">stats</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="n">plots</span><span class="p">,</span> <span class="n">save_dir</span><span class="o">=</span><span class="n">save_dir</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="n">names</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>
<p>For each class, precision and recall are calculated for 10 IoU thresholds using the following formulas:</p>
<ul>
<li>$Precision = \frac{TP}{TP+FP} = \frac{TP}{number\ of\ detections}$</li>
<li>$Recall = \frac{TP}{TP+FN} = \frac{TP}{number\ of\ GTs}$</li>
<li>Since duplicates are filtered using <em><strong>np.unique</strong></em> in the <em><strong>process_batch</strong></em> calculation above, both precision and recall can have a maximum value of 1.</li>
</ul>
</li>
<li>
<p>On a coordinate plane where the x-axis is Recall and the y-axis is Precision, each detection result is plotted as a point. Connecting all these points forms the Precision-Recall Curve.</p>
</li>
<li>
<p>In the figure below, the letters represent each image.
<img src="/p/yolov5_val/ap_graph_01.png"
	width="578"
	height="440"
	srcset="/p/yolov5_val/ap_graph_01_hu44757a369e30714e242596f179ad2185_50954_480x0_resize_box_3.png 480w, /p/yolov5_val/ap_graph_01_hu44757a369e30714e242596f179ad2185_50954_1024x0_resize_box_3.png 1024w"
	loading="lazy"
	
		alt="AP Graph 01"
	
	
		class="gallery-image" 
		data-flex-grow="131"
		data-flex-basis="315px"
	
><br>
<span style="font-size:70%"> Source: <a class="link" href="https://github.com/rafaelpadilla/Object-Detection-Metrics"  target="_blank" rel="noopener"
    ><em>https://github.com/rafaelpadilla/Object-Detection-Metrics</em></a></span></p>
</li>
<li>
<p>As in the figure below, the entire recall range is divided evenly, and Interpolated Precision is calculated for each region. In this example, it is divided into 11 regions, but in YOLOv5, it is divided into 1000.
<img src="/p/yolov5_val/ap_graph_02.png"
	width="556"
	height="452"
	srcset="/p/yolov5_val/ap_graph_02_hu3ac04bf34b3d5aaa1f47ed44ed0b6604_28288_480x0_resize_box_3.png 480w, /p/yolov5_val/ap_graph_02_hu3ac04bf34b3d5aaa1f47ed44ed0b6604_28288_1024x0_resize_box_3.png 1024w"
	loading="lazy"
	
		alt="AP Graph 02"
	
	
		class="gallery-image" 
		data-flex-grow="123"
		data-flex-basis="295px"
	
><br>
<span style="font-size:70%"> Source: <a class="link" href="https://github.com/rafaelpadilla/Object-Detection-Metrics"  target="_blank" rel="noopener"
    ><em>https://github.com/rafaelpadilla/Object-Detection-Metrics</em></a></span></p>
</li>
<li>
<p>The interpolated precision is plotted on the axis to create a new Precision-Recall Curve as follows.
<img src="/p/yolov5_val/ap_graph_03.png"
	width="554"
	height="433"
	srcset="/p/yolov5_val/ap_graph_03_hu24f08e0ccede7197fd5edc156cb1098c_28102_480x0_resize_box_3.png 480w, /p/yolov5_val/ap_graph_03_hu24f08e0ccede7197fd5edc156cb1098c_28102_1024x0_resize_box_3.png 1024w"
	loading="lazy"
	
		alt="AP Graph 03"
	
	
		class="gallery-image" 
		data-flex-grow="127"
		data-flex-basis="307px"
	
><br>
<span style="font-size:70%"> Source: <a class="link" href="https://github.com/rafaelpadilla/Object-Detection-Metrics"  target="_blank" rel="noopener"
    ><em>https://github.com/rafaelpadilla/Object-Detection-Metrics</em></a></span></p>
</li>
<li>
<p>The area under this new Precision-Recall Curve (Area Under Curve, AUC) becomes the AP value.
<img src="/p/yolov5_val/ap_graph_04.png"
	width="557"
	height="437"
	srcset="/p/yolov5_val/ap_graph_04_hu072cf6212aa09f8b46b40cea8dc57e02_28126_480x0_resize_box_3.png 480w, /p/yolov5_val/ap_graph_04_hu072cf6212aa09f8b46b40cea8dc57e02_28126_1024x0_resize_box_3.png 1024w"
	loading="lazy"
	
		alt="AP Graph 04"
	
	
		class="gallery-image" 
		data-flex-grow="127"
		data-flex-basis="305px"
	
><br>
<span style="font-size:70%"> Source: <a class="link" href="https://github.com/rafaelpadilla/Object-Detection-Metrics"  target="_blank" rel="noopener"
    ><em>https://github.com/rafaelpadilla/Object-Detection-Metrics</em></a></span></p>
</li>
<li>
<p>In this way, YOLOv5 calculates class-wise AP using <em><strong>ap_per_class</strong></em>, and then uses the average of AP values as the object detection performance metric called Mean Average Precision (mAP).</p>
</li>
</ul>

</section>


    <footer class="article-footer">
    
    <section class="article-tags">
        
            <a href="/tags/yolov5/">YOLOv5</a>
        
    </section>


    
    <section class="article-copyright">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <path d="M14.5 9a3.5 4 0 1 0 0 6" />
</svg>



        <span>Licensed under CC BY-NC-SA 4.0</span>
    </section>
    </footer>


    
        <link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css"integrity="sha384-n8MVd4RsNIU0tAv4ct0nTaAbDJwPJzDEaqSD1odI&#43;WdtXRGWt2kTvGFasHpSy3SV"crossorigin="anonymous"
            ><script 
                src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"integrity="sha384-XjKyOOlGwcjNTAIQHIpgOno0Hl1YQqzUOEleOLALmuqehneUG&#43;vnGctmUb0ZY0l8"crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"integrity="sha384-&#43;VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4&#43;/RRE05"crossorigin="anonymous"
                defer
                >
            </script><script>
    window.addEventListener("DOMContentLoaded", () => {
	const mainArticleElement = document.querySelector(".main-article");
        renderMathInElement(mainArticleElement, {
            delimiters: [
                { left: "$$", right: "$$", display: true },
                { left: "$", right: "$", display: false },
                { left: "\\(", right: "\\)", display: false },
                { left: "\\[", right: "\\]", display: true }
            ],
            ignoredClasses: ["gist"]
        });})
</script>

    
</article>

    

    

<aside class="related-content--wrapper">
    <h2 class="section-title">Related content</h2>
    <div class="related-content">
        <div class="flex article-list--tile">
            
                
<article class="">
    <a href="/p/yolov5_loss/">
        
        

        <div class="article-details">
            <h2 class="article-title">YOLOv5 Loss</h2>
        </div>
    </a>
</article>

            
                
<article class="">
    <a href="/p/yolov5_augmentation/">
        
        

        <div class="article-details">
            <h2 class="article-title">YOLOv5 Augmentation</h2>
        </div>
    </a>
</article>

            
                
<article class="">
    <a href="/p/yolov5_evolve/">
        
        

        <div class="article-details">
            <h2 class="article-title">YOLOv5 Evolve</h2>
        </div>
    </a>
</article>

            
                
<article class="">
    <a href="/p/yolov5_anchor/">
        
        

        <div class="article-details">
            <h2 class="article-title">YOLOv5 anchor</h2>
        </div>
    </a>
</article>

            
                
<article class="">
    <a href="/p/yolov5_train/">
        
        

        <div class="article-details">
            <h2 class="article-title">YOLOv5 Training</h2>
        </div>
    </a>
</article>

            
        </div>
    </div>
</aside>

     
    
        
    <script src="https://utteranc.es/client.js" 
        repo="kimberlykang/utterances"
        issue-term="pathname"
        
        crossorigin="anonymous"
        async
        >
</script>

<style>
    .utterances {
        max-width: unset;
    }
</style>

<script>
    let utterancesLoaded = false;

    function setUtterancesTheme(theme) {
        let utterances = document.querySelector('.utterances iframe');
        if (utterances) {
            utterances.contentWindow.postMessage(
                {
                    type: 'set-theme',
                    theme: `github-${theme}`
                },
                'https://utteranc.es'
            );
        }
    }

    addEventListener('message', event => {
        if (event.origin !== 'https://utteranc.es') return;

        
        utterancesLoaded = true;
        setUtterancesTheme(document.documentElement.dataset.scheme)
    });

    window.addEventListener('onColorSchemeChange', (e) => {
        if (!utterancesLoaded) return;
        setUtterancesTheme(e.detail)
    })
</script>


    

    <footer class="site-footer">
    <section class="copyright">
        &copy; 
        
            2023 - 
        
        2025 Kimberly&#39;s Blog
    </section>
    
    <section class="powerby">
        Built with <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> <br />
        Theme <b><a href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener" data-version="3.30.0">Stack</a></b> designed by <a href="https://jimmycai.com" target="_blank" rel="noopener">Jimmy</a>
    </section>
</footer>


    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css"crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css"crossorigin="anonymous"
            >

            </main>
        </div>
        <script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js"integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z&#43;KMkF24hUW8WePSA9HM="crossorigin="anonymous"
                
                >
            </script><script type="text/javascript" src="/ts/main.1e9a3bafd846ced4c345d084b355fb8c7bae75701c338f8a1f8a82c780137826.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>

    </body>
</html>
