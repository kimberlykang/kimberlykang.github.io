<!DOCTYPE html>
<html lang="en" dir="ltr">
    <head><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content="In this post, we will look at the Loss function of YOLOv5. Table of Contents Information Theory Binary Cross Entropy IoU Loss YOLOv5 Loss Information Theory Information If the probability of an event A occurring is P(A), the amount of information for this event is $I=-\\log P(A)$. Example: Information when a coin lands on heads Probability: $ \\displaystyle \\frac{1}{2}$ $I=-\\log \\displaystyle \\frac{1}{2}$ Entropy The expected value of the information. $ H(X)=- \\displaystyle \\sum_{x}P(X) \\log P(X)$ Example: Entropy of a coin flip $Entropy= \\displaystyle{ -(\\frac{1}{2} \\times \\log \\frac{1}{2} + \\frac{1}{2} \\times \\log \\frac{1}{2})=-\\log \\frac{1}{2}}$ Kullback–Leibler divergence (KL Divergence)">
<title>YOLOv5 Loss</title>

<link rel='canonical' href='https://kimberlykang.github.io/p/yolov5_loss/'>

<link rel="stylesheet" href="/scss/style.min.663803bebe609202d5b39d848f2d7c2dc8b598a2d879efa079fa88893d29c49c.css"><meta property='og:title' content="YOLOv5 Loss">
<meta property='og:description' content="In this post, we will look at the Loss function of YOLOv5. Table of Contents Information Theory Binary Cross Entropy IoU Loss YOLOv5 Loss Information Theory Information If the probability of an event A occurring is P(A), the amount of information for this event is $I=-\\log P(A)$. Example: Information when a coin lands on heads Probability: $ \\displaystyle \\frac{1}{2}$ $I=-\\log \\displaystyle \\frac{1}{2}$ Entropy The expected value of the information. $ H(X)=- \\displaystyle \\sum_{x}P(X) \\log P(X)$ Example: Entropy of a coin flip $Entropy= \\displaystyle{ -(\\frac{1}{2} \\times \\log \\frac{1}{2} + \\frac{1}{2} \\times \\log \\frac{1}{2})=-\\log \\frac{1}{2}}$ Kullback–Leibler divergence (KL Divergence)">
<meta property='og:url' content='https://kimberlykang.github.io/p/yolov5_loss/'>
<meta property='og:site_name' content='Kimberly&#39;s Blog'>
<meta property='og:type' content='article'><meta property='article:section' content='Post' /><meta property='article:tag' content='YOLOv5' /><meta property='article:published_time' content='2023-04-11T00:20:00&#43;09:00'/><meta property='article:modified_time' content='2023-04-11T00:20:00&#43;09:00'/>
<meta name="twitter:title" content="YOLOv5 Loss">
<meta name="twitter:description" content="In this post, we will look at the Loss function of YOLOv5. Table of Contents Information Theory Binary Cross Entropy IoU Loss YOLOv5 Loss Information Theory Information If the probability of an event A occurring is P(A), the amount of information for this event is $I=-\\log P(A)$. Example: Information when a coin lands on heads Probability: $ \\displaystyle \\frac{1}{2}$ $I=-\\log \\displaystyle \\frac{1}{2}$ Entropy The expected value of the information. $ H(X)=- \\displaystyle \\sum_{x}P(X) \\log P(X)$ Example: Entropy of a coin flip $Entropy= \\displaystyle{ -(\\frac{1}{2} \\times \\log \\frac{1}{2} + \\frac{1}{2} \\times \\log \\frac{1}{2})=-\\log \\frac{1}{2}}$ Kullback–Leibler divergence (KL Divergence)"><style>
     
    :root {
        --article-font-family: "Open Sans", var(--base-font-family);
    }

     
    * {
        font-family: "Open Sans", var(--base-font-family);
    }

     
    *:lang(ko),
    *[lang="ko"],
    *[lang="ko-KR"],
    *[lang="ko-KP"] {
        font-family: "Nanum Gothic", var(--base-font-family);
    }

     
    *:lang(ko) *:not(:lang(ko)),
    *[lang="ko"] *:not([lang="ko"]),
    *[lang="ko-KR"] *:not([lang="ko-KR"]),
    *[lang="ko-KP"] *:not([lang="ko-KP"]) {
        font-family: "Open Sans", var(--base-font-family);
    }
</style>

<script>
    (function () {
        
        const nanumGothic = document.createElement('link');
        nanumGothic.href = "https://fonts.googleapis.com/css?family=Nanum+Gothic:400";
        nanumGothic.type = "text/css";
        nanumGothic.rel = "stylesheet";
        document.head.appendChild(nanumGothic);

        
        const openSans = document.createElement('link');
        openSans.href = "https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,300..800;1,300..800&display=swap";
        openSans.type = "text/css";
        openSans.rel = "stylesheet";
        document.head.appendChild(openSans);
    }());
</script>
    </head>
    <body class="
    article-page
    ">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            if(!localStorage.getItem(colorSchemeKey)){
                localStorage.setItem(colorSchemeKey, "auto");
            }
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky ">
    <button class="hamburger hamburger--spin" type="button" id="toggle-menu" aria-label="Toggle Menu">
        <span class="hamburger-box">
            <span class="hamburger-inner"></span>
        </span>
    </button>

    <header>
        
            
            <figure class="site-avatar">
                <a href="/">
                
                    
                    
                    
                        
                        <img src="/img/kimberly_avatar_hu92a1a2905f7ef83b94672016a24ef023_184760_300x0_resize_q75_box.jpeg" width="300"
                            height="300" class="site-logo" loading="lazy" alt="Avatar">
                    
                
                </a>
                
            </figure>
            
        
        
        <div class="site-meta">
            <h1 class="site-name"><a href="/">Kimberly&#39;s Blog</a></h1>
            <h2 class="site-description">Vision Engineer</h2>
        </div>
    </header><ol class="menu" id="main-menu">
        
        
        
        <li >
            <a href='/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <polyline points="5 12 3 12 12 3 21 12 19 12" />
  <path d="M5 12v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-7" />
  <path d="M9 21v-6a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v6" />
</svg>



                
                <span>Home</span>
            </a>
        </li>
        
        
        <li >
            <a href='/archives/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <rect x="3" y="4" width="18" height="4" rx="2" />
  <path d="M5 8v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-10" />
  <line x1="10" y1="12" x2="14" y2="12" />
</svg>



                
                <span>Archives</span>
            </a>
        </li>
        
        
        <li >
            <a href='/search/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="10" cy="10" r="7" />
  <line x1="21" y1="21" x2="15" y2="15" />
</svg>



                
                <span>Search</span>
            </a>
        </li>
        
        
        <li >
            <a href='/links/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M10 14a3.5 3.5 0 0 0 5 0l4 -4a3.5 3.5 0 0 0 -5 -5l-.5 .5" />
  <path d="M14 10a3.5 3.5 0 0 0 -5 0l-4 4a3.5 3.5 0 0 0 5 5l.5 -.5" />
</svg>



                
                <span>Links</span>
            </a>
        </li>
        
        <li class="menu-bottom-section">
            <ol class="menu">
                    
                        <li id="i18n-switch">  
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-language" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M4 5h7" />
  <path d="M9 3v2c0 4.418 -2.239 8 -5 8" />
  <path d="M5 9c-.003 2.144 2.952 3.908 6.7 4" />
  <path d="M12 20l4 -9l4 9" />
  <path d="M19.1 18h-6.2" />
</svg>



                            <select name="language" title="language" onchange="window.location.href = this.selectedOptions[0].value">
                                
                                    <option value="https://kimberlykang.github.io/" selected>English</option>
                                
                                    <option value="https://kimberlykang.github.io/ko/" >Korean</option>
                                
                            </select>
                        </li>
                    
                

                
                    <li id="dark-mode-toggle">
                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="8" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="16" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                        <span>Dark Mode</span>
                    </li>
                
            </ol>
        </li>
    </ol>
</aside>

    <aside class="sidebar right-sidebar sticky">
        
            
                
    <section class="widget archives">
        <div class="widget-icon">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <line x1="5" y1="9" x2="19" y2="9" />
  <line x1="5" y1="15" x2="19" y2="15" />
  <line x1="11" y1="4" x2="7" y2="20" />
  <line x1="17" y1="4" x2="13" y2="20" />
</svg>



        </div>
        <h2 class="widget-title section-title">Table of contents</h2>
        
        <div class="widget--toc">
            <nav id="TableOfContents">
  <ol>
    <li><a href="#information-theory">Information Theory</a></li>
  </ol>

  <ol>
    <li><a href="#iou-loss">IoU Loss</a></li>
    <li><a href="#yolov5-loss">YOLOv5 Loss</a></li>
  </ol>
</nav>
        </div>
    </section>

            
        
    </aside>


            <main class="main full-width">
    <article class="main-article">
    <header class="article-header">

    <div class="article-details">
    
    <header class="article-category">
        
            <a href="/categories/yolov5/" style="background-color: #2a9d8f; color: #fff;">
                YOLOv5
            </a>
        
    </header>
    

    <div class="article-title-wrapper">
        <h2 class="article-title">
            <a href="/p/yolov5_loss/">YOLOv5 Loss</a>
        </h2>
    
        
    </div>

    
    
    
    
    <footer class="article-time">
        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4" />
  <circle cx="18" cy="18" r="4" />
  <path d="M15 3v4" />
  <path d="M7 3v4" />
  <path d="M3 11h16" />
  <path d="M18 16.496v1.504l1 1" />
</svg>
                <time class="article-time--published">Apr 11, 2023</time>
            </div>
        

        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



                <time class="article-time--reading">
                    8 minute read
                </time>
            </div>
        
    </footer>
    

    
        <footer class="article-translations">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-language" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M4 5h7" />
  <path d="M9 3v2c0 4.418 -2.239 8 -5 8" />
  <path d="M5 9c-.003 2.144 2.952 3.908 6.7 4" />
  <path d="M12 20l4 -9l4 9" />
  <path d="M19.1 18h-6.2" />
</svg>



            <div>
                
                    <a href="https://kimberlykang.github.io/ko/p/yolov5_loss/" class="link">Korean</a>
                
            </div>
        </footer>
    
</div>

</header>

    <section class="article-content">
    
    
    <p>In this post, we will look at the Loss function of YOLOv5.</p>
<h1 id="table-of-contents">Table of Contents
</h1><ol>
<li><a class="link" href="#information-theory" >Information Theory</a></li>
<li><a class="link" href="#binary-cross-entropy" >Binary Cross Entropy</a></li>
<li><a class="link" href="#iou-loss" >IoU Loss</a></li>
<li><a class="link" href="#yolov5-loss" >YOLOv5 Loss</a></li>
</ol>
<h2 id="information-theory">Information Theory
</h2><ul>
<li>
<p>Information</p>
<ul>
<li>If the probability of an event A occurring is P(A), the amount of information for this event is $I=-\log P(A)$.</li>
<li>Example: Information when a coin lands on heads
<ul>
<li>Probability: $ \displaystyle \frac{1}{2}$</li>
<li>$I=-\log  \displaystyle \frac{1}{2}$</li>
</ul>
</li>
</ul>
</li>
<li>
<p>Entropy</p>
<ul>
<li>The expected value of the information.</li>
<li>$ H(X)=- \displaystyle \sum_{x}P(X) \log P(X)$</li>
<li>Example: Entropy of a coin flip
<ul>
<li>$Entropy= \displaystyle{ -(\frac{1}{2} \times \log \frac{1}{2} + \frac{1}{2} \times \log \frac{1}{2})=-\log \frac{1}{2}}$</li>
</ul>
</li>
</ul>
</li>
<li>
<p>Kullback–Leibler divergence (KL Divergence)</p>
<ul>
<li>Measures the difference between two probability distributions.</li>
<li>$ D_{KL}(P \Vert Q)= \displaystyle \sum_{x}P(X) \log \frac{P(X)}{Q(X)} $<br>
                         
$ = -\displaystyle \sum_{x}P(X) \log Q(X) +\sum_{x} P(X) \log P(X)$<br>
                         
<ul>
<li>The first term is the entropy calculated using distribution Q for data from distribution P.</li>
<li>The second term is the entropy of the distribution P.</li>
<li>In other words, KL divergence tells you how much more information you have when using Q to encode P compared to using P itself.</li>
</ul>
</li>
</ul>
</li>
<li>
<p>Cross Entropy</p>
<ul>
<li>The first term of the KL divergence above, i.e. the expected value of information when using distribution Q for data from distribution P, is called the Cross Entropy.</li>
<li>$ H(P, Q)= -\displaystyle \sum_{x}P(X)\log Q(X) $</li>
<li>KL divergence can be rearranged as below:
<ul>
<li>$ D_{KL}(P \Vert Q)= H(P, Q) - H(P) $</li>
<li>Here, P is the true distribution, Q is the distribution produced by an approximate model, and H(P) is constant. Therefore, cross-entropy H(P, Q) is often used as a model’s loss when minimizing KL divergence.</li>
</ul>
</li>
</ul>
</li>
</ul>
<h1 id="binary-cross-entropy">Binary Cross Entropy
</h1><ul>
<li>Cross Entropy Loss
<ul>
<li>In classification, the data label y is given as a one-hot vector, where y is probability distribution P in the formula for cross entropy above.</li>
<li>The model output $\hat y$ is typically the softmax output probabilities for each class, i.e., distribution Q.</li>
<li>When N is the number of data samples, y the labels, and C the number of classes, the Cross Entropy Loss L is:
<ul>
<li>$ L= - \displaystyle \sum_{n}^{N} \displaystyle \sum_{c}^{C}y_{n, c} \log \hat{y}_{n, c}$</li>
</ul>
</li>
<li>For example, in a classification problem with &lsquo;dog&rsquo;, &lsquo;cat&rsquo;, and &lsquo;frog&rsquo;:
<ul>
<li>$y=\begin{bmatrix} 0 \cr 1 \cr 0 \end{bmatrix} $ (True label)</li>
<li>$\hat y=\begin{bmatrix} 0.1 \cr 0.7 \cr 0.2 \end{bmatrix} $ (Prediction)</li>
<li>The cross-entropy loss $l$ for this image is:
<ul>
<li>$ l= -\displaystyle \sum_{c}^{C}y_c\log \hat{y}_c$<br>
$=0⋅\log 0.1 + 1⋅\log 0.7 + 0⋅\log 0.2$  <br>
$=\log 0.7$</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>Binary Cross Entropy
<ul>
<li>A special case of cross entropy loss when the number of classes is two.</li>
<li>The model’s output $\hat y$ is usually the probability from a sigmoid function.</li>
<li>$ L= - \displaystyle \sum_{n}^{N} [y_n\log \hat{y}_n + (1-y_n)\log (1-\hat{y}_n)]$</li>
</ul>
</li>
<li>BCEWithLogitsLoss
<ul>
<li>Torch provides the BCEWithLogitsLoss class, which combines the Sigmoid layer and the Binary Cross Entropy.</li>
<li>It is more numerically stable than using Sigmoid and BCELoss separately, due to the log-sum-exp trick.</li>
<li>If x is the input to Sigmoid, y the label, N the number of samples, and w the weight, the unreduced loss L is:
<ul>
<li>$ L=\begin{Bmatrix} l_{1}, \cr &hellip;, \cr l_{N} \end{Bmatrix}$ where $l_n= - w_n [(y_n\log \sigma (x_n)) + (1-y_n)\log (1-\sigma(x_n))]$</li>
</ul>
</li>
<li>The reduced loss L is:
<ul>
<li>$ L=\begin{cases} mean(L), \text{if reduction=&lsquo;mean&rsquo;} \cr sum(L), \text{if reduction= &lsquo;sum&rsquo;} \end{cases} $</li>
</ul>
</li>
<li>With c as the class, you can adjust precision and recall by using a positive weight $p_c$. The formula becomes:
<ul>
<li>$ L_c=\begin{Bmatrix} l_{1,c}, \cr &hellip;, \cr l_{N, c} \end{Bmatrix}$ where $l_{n, c}= - w_{n,c} [(p_c ​⋅ y_{n, c}\log \sigma (x_n)) + (1-y_{n, c})\log (1-\sigma(x_{n, c}))]$</li>
<li>$p_c&gt;1$ increases recall, $p_c&lt;1$ increases precision.</li>
<li>If there are 100 positive and 300 negative examples for a class, set $p_c=\frac{300}{100}=3$.</li>
</ul>
</li>
<li><em><strong>torch.nn.BCEWithLogitsLoss</strong></em>(<code>weight</code>=None, <code>size_average</code>=None, <code>reduce</code>=None, <code>reduction</code>=&lsquo;mean&rsquo;, <code>pos_weight</code>=None)
<ul>
<li><code>size_average</code>, <code>reduce</code> are deprecated parameters.
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">target</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">ones</span><span class="p">([</span><span class="mi">10</span><span class="p">,</span> <span class="mi">64</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>  <span class="c1"># 64 classes, batch size = 10</span>
</span></span><span class="line"><span class="cl"><span class="n">output</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">full</span><span class="p">([</span><span class="mi">10</span><span class="p">,</span> <span class="mi">64</span><span class="p">],</span> <span class="mf">1.5</span><span class="p">)</span>  <span class="c1"># A prediction (logit)</span>
</span></span><span class="line"><span class="cl"><span class="n">pos_weight</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">ones</span><span class="p">([</span><span class="mi">64</span><span class="p">])</span>  <span class="c1"># All weights are equal to 1</span>
</span></span><span class="line"><span class="cl"><span class="n">criterion</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">BCEWithLogitsLoss</span><span class="p">(</span><span class="n">pos_weight</span><span class="o">=</span><span class="n">pos_weight</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">criterion</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span>  <span class="c1"># -log(sigmoid(1.5))</span>
</span></span><span class="line"><span class="cl"><span class="c1"># tensor(0.20...)</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="iou-loss">IoU Loss
</h2><ul>
<li>
<p>Intersection over Union (IoU)</p>
<ul>
<li>Scale invariant.</li>
<li>When you have convex A and B, IoU is calculated as follows:
<ul>
<li>$ IoU= \displaystyle  \frac{|A∩B|}{|A∪B|} $</li>
</ul>
</li>
<li>$L_{IoU}=1-IoU$</li>
<li>When IoU is 0, i.e., when the target box and prediction box do not overlap in object detection, IoU does not indicate how large the error is. As a result, the <strong>Gradient Vanishing</strong> problem occurs.</li>
</ul>
</li>
<li>
<p>Generalized-IoU (GIoU)</p>
<ul>
<li><a class="link" href="https://openaccess.thecvf.com/content_CVPR_2019/papers/Rezatofighi_Generalized_Intersection_Over_Union_A_Metric_and_a_Loss_for_CVPR_2019_paper.pdf"  target="_blank" rel="noopener"
    >Generalized Intersection Over Union: A Metric and a Loss for Bounding Box Regression</a></li>
<li>If C is the smallest convex that contains A and B, GIoU is calculated as:
<ul>
<li>$ GIoU=IoU- \displaystyle  \frac{|C \backslash (A∪B)|}{|C|} $</li>
<li>$ C \backslash (A∪B)$ means set difference.</li>
</ul>
</li>
<li>$L_{GIoU}=1-GIoU$. The range of loss value is 0~2.</li>
<li>If the target box contains the prediction box, the penalty term is zero and $L_{GIoU}$ becomes the same as $L_{IoU}$.
<img style="max-width:65%; height:auto;" src="iou_losses.png" alt="IoU Losses" /><br>
<span style="font-size:70%"> Source: <a class="link" href="https://ojs.aaai.org/index.php/AAAI/article/view/6999/6853"  target="_blank" rel="noopener"
    ><em>Zheng, Zhaohui, et al. &ldquo;Distance-IoU loss: Faster and better learning for bounding box regression.&rdquo; Proceedings of the AAAI conference on artificial intelligence. Vol. 34. No. 07. 2020, Figure 2</em></a></span></li>
<li>Has slow convergence and comparatively low box accuracy.</li>
</ul>
</li>
<li>
<p>Distance-IoU (DIoU) &amp; Complete IoU (CIoU)</p>
<ul>
<li><a class="link" href="https://ojs.aaai.org/index.php/AAAI/article/view/6999/6853"  target="_blank" rel="noopener"
    >Distance-IoU Loss: Faster and Better Learning for Bounding Box Regression</a></li>
<li>In general, IoU-based loss can be defined as $L_{IoU}=1-IoU + \mathcal{R}(B, B^{gt})$.</li>
<li>DIoU
<ul>
<li>$ \mathcal{R}_{DIoU} =  \displaystyle  \frac{ρ^2(b, b^{gt})}{c^2}$. ρ is the Euclidean distance between the centers of the two boxes, and c is the diagonal length of the smallest box enclosing both boxes.<br>
<img style="max-width:25%; height:auto;" src="distance_for_diou.png" alt="Distance for DIoU" /><br>
<span style="font-size:70%"> Source: <a class="link" href="https://ojs.aaai.org/index.php/AAAI/article/view/6999/6853"  target="_blank" rel="noopener"
    ><em>Zheng, Zhaohui, et al. &ldquo;Distance-IoU loss: Faster and better learning for bounding box regression.&rdquo; Proceedings of the AAAI conference on artificial intelligence. Vol. 34. No. 07. 2020, Figure 5</em></a></span></li>
<li>$L_{DIoU}=1-IoU + \mathcal{R}_{DIoU}$, range is 0~2.</li>
<li>Since the distance between boxes is minimized, it converges faster than GIoU loss.</li>
</ul>
</li>
<li>CIoU
<ul>
<li>This is an extension of DIoU to additionally consider the aspect ratio.</li>
<li>$ \mathcal{R}_{CIoU} = \displaystyle \frac{ρ^2(b, b^{gt})}{c^2} + \alpha v$
<ul>
<li>$\alpha = \displaystyle \frac{v}{(1-IoU) + v}$
<ul>
<li>Gives higher priority to regression in non-overlapping cases.</li>
</ul>
</li>
<li>$v = \displaystyle \frac{4}{\pi^2}(arctan\frac{w^{gt}}{h^{gt}} - arctan\frac{w}{h})^2$
<ul>
<li>Measures the similarity of aspect ratios.</li>
<li>$ \displaystyle \frac{4}{\pi^2}$ is to make the maximum calculation result 1 since arctan max is $\frac{\pi}{2}$.</li>
</ul>
</li>
</ul>
</li>
<li>$L_{CIoU}=1-IoU + \mathcal{R}_{CIoU}$</li>
</ul>
</li>
<li>Non-Maximum Suppression (NMS) using DIoU
<ul>
<li>In traditional NMS, the IoU metric is used to remove unnecessary detection boxes.</li>
<li>Since IoU only considers the overlapping area, incorrect boxes can be suppressed in occlusion situations.</li>
<li>DIoU considers both the overlapping area and the center point distance between the two boxes, making it more suitable as a criterion for NMS in case of occlusion.</li>
<li>Let $\mathcal{M}$ be the prediction box with the highest score, $B$ other boxes to apply NMS to, $s$ is the classification score, and $\epsilon$ is the NMS threshold. DIoU-NMS is defined as:
<ul>
<li>$ s_i= \begin{cases} \displaystyle s_i, &amp; IoU -\mathcal{R}(\mathcal{M}, B_i) &lt; \epsilon \\ \displaystyle 0, &amp; IoU -\mathcal{R}(\mathcal{M}, B_i) ≥ \epsilon  \end{cases} $</li>
</ul>
</li>
<li>Below is an example using a YOLOv3 model trained on PASCAL VOC07+12, detecting an image from MS COCO 2017.
<img style="max-width:80%; height:auto;" src="viz_result_diou_nms.png" alt="Visualization of Result with DIoU-NMS" /><br>
<span style="font-size:70%"> Source: <a class="link" href="https://ojs.aaai.org/index.php/AAAI/article/view/6999/6853"  target="_blank" rel="noopener"
    ><em>Zheng, Zhaohui, et al. &ldquo;Distance-IoU loss: Faster and better learning for bounding box regression.&rdquo; Proceedings of the AAAI conference on artificial intelligence. Vol. 34. No. 07. 2020, Figure 8</em></a></span></li>
</ul>
</li>
<li>Experimental Results
<ul>
<li>Below are results for training YOLOv3 with $ L_{IoU} $, $ L_{GIoU} $, $ L_{DIoU} $, $ L_{CIoU} $. (D) means IoU-NMS is used during NMS.<br>
<img style="max-width:80%; height:auto;" src="results_yolov3.png" alt="Results with YOLOv3" /><br>
<span style="font-size:70%"> Source: <a class="link" href="https://ojs.aaai.org/index.php/AAAI/article/view/6999/6853"  target="_blank" rel="noopener"
    ><em>Zheng, Zhaohui, et al. &ldquo;Distance-IoU loss: Faster and better learning for bounding box regression.&rdquo; Proceedings of the AAAI conference on artificial intelligence. Vol. 34. No. 07. 2020, Table 1</em></a></span></li>
<li>Below are results for training SSD with $ L_{IoU} $, $ L_{GIoU} $, $ L_{DIoU} $, $ L_{CIoU} $. (D) means IoU-NMS is used during NMS.<br>
<img style="max-width:50%; height:auto;" src="results_ssd.png" alt="Results with SSD" /><br>
<span style="font-size:70%"> Source: <a class="link" href="https://ojs.aaai.org/index.php/AAAI/article/view/6999/6853"  target="_blank" rel="noopener"
    ><em>Zheng, Zhaohui, et al. &ldquo;Distance-IoU loss: Faster and better learning for bounding box regression.&rdquo; Proceedings of the AAAI conference on artificial intelligence. Vol. 34. No. 07. 2020, Table 2</em></a></span></li>
<li>Below are results for training Faster-RCNN with $ L_{IoU} $, $ L_{GIoU} $, $ L_{DIoU} $, $ L_{CIoU} $. (D) means IoU-NMS is used during NMS.<br>
<img style="max-width:90%; height:auto;" src="results_faster_rcnn.png" alt="Results with Faster-RCNN" /><br>
<span style="font-size:70%"> Source: <a class="link" href="https://ojs.aaai.org/index.php/AAAI/article/view/6999/6853"  target="_blank" rel="noopener"
    ><em>Zheng, Zhaohui, et al. &ldquo;Distance-IoU loss: Faster and better learning for bounding box regression.&rdquo; Proceedings of the AAAI conference on artificial intelligence. Vol. 34. No. 07. 2020, Table 3</em></a></span></li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="yolov5-loss">YOLOv5 Loss
</h2><ul>
<li>
<p>Box Loss</p>
<ul>
<li><code>pbox</code>: (number of predictions, number of anchors)</li>
<li><code>iou</code>: (number of predictions)</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># Regression</span>
</span></span><span class="line"><span class="cl"><span class="n">pxy</span> <span class="o">=</span> <span class="n">pxy</span><span class="o">.</span><span class="n">sigmoid</span><span class="p">()</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">-</span> <span class="mf">0.5</span>
</span></span><span class="line"><span class="cl"><span class="n">pwh</span> <span class="o">=</span> <span class="p">(</span><span class="n">pwh</span><span class="o">.</span><span class="n">sigmoid</span><span class="p">()</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">anchors</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">pbox</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">((</span><span class="n">pxy</span><span class="p">,</span> <span class="n">pwh</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># predicted box </span>
</span></span><span class="line"><span class="cl"><span class="n">iou</span> <span class="o">=</span> <span class="n">bbox_iou</span><span class="p">(</span><span class="n">pbox</span><span class="p">,</span> <span class="n">tbox</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">CIoU</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>  <span class="c1"># iou</span>
</span></span><span class="line"><span class="cl"><span class="n">lbox</span> <span class="o">+=</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">iou</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>  <span class="c1"># iou loss</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>Objectness Loss</p>
<ul>
<li>The IoU between the target box and prediction box becomes the ground truth (GT).</li>
<li>Objectness Loss is calculated by applying different weights for each scale.
<ul>
<li>$ L_{obj}=4.0 ⋅L_{obj}^{small} +1.0 ⋅ L_{obj}^{medium} +0.4 ⋅ L_{obj}^{large}$</li>
</ul>
</li>
<li><code>pi[..., 4]</code>: (batch size, number of anchors, number of grids, number of grids) Represents the objectness predicted by the model.</li>
<li><code>tobj</code>: (batch size, number of anchors, number of grids, number of grids) Represents the target objectness for the corresponding batch, anchor, and grid location.</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># Objectness</span>
</span></span><span class="line"><span class="cl"><span class="c1"># BCEobj = nn.BCEWithLogitsLoss(pos_weight=torch.tensor([h[&#39;obj_pw&#39;]], device=device))</span>
</span></span><span class="line"><span class="cl"><span class="n">iou</span> <span class="o">=</span> <span class="n">iou</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">clamp</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">type</span><span class="p">(</span><span class="n">tobj</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sort_obj_iou</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">j</span> <span class="o">=</span> <span class="n">iou</span><span class="o">.</span><span class="n">argsort</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">gj</span><span class="p">,</span> <span class="n">gi</span><span class="p">,</span> <span class="n">iou</span> <span class="o">=</span> <span class="n">b</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">a</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">gj</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">gi</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">iou</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">gr</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span> <span class="c1"># default 1.0</span>
</span></span><span class="line"><span class="cl">    <span class="n">iou</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">gr</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">gr</span> <span class="o">*</span> <span class="n">iou</span>
</span></span><span class="line"><span class="cl"><span class="n">tobj</span><span class="p">[</span><span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">gj</span><span class="p">,</span> <span class="n">gi</span><span class="p">]</span> <span class="o">=</span> <span class="n">iou</span>  <span class="c1"># iou ratio</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">obji</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">BCEobj</span><span class="p">(</span><span class="n">pi</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="n">tobj</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">lobj</span> <span class="o">+=</span> <span class="n">obji</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">balance</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>  <span class="c1"># obj loss</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>Classification Loss</p>
<ul>
<li><code>t</code>: (number of detections, number of classes)</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># Classification</span>
</span></span><span class="line"><span class="cl"><span class="c1"># BCEcls = nn.BCEWithLogitsLoss(pos_weight=torch.tensor([h[&#39;cls_pw&#39;]], device=device))</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nc</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># cls loss (only if multiple classes)</span>
</span></span><span class="line"><span class="cl">    <span class="n">t</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">full_like</span><span class="p">(</span><span class="n">pcls</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cn</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>  <span class="c1"># targets</span>
</span></span><span class="line"><span class="cl">    <span class="n">t</span><span class="p">[</span><span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">),</span> <span class="n">tcls</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cp</span>
</span></span><span class="line"><span class="cl">    <span class="n">lcls</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">BCEcls</span><span class="p">(</span><span class="n">pcls</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>  <span class="c1"># BCE</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>Total Loss</p>
<ul>
<li>$Loss=\lambda_{box} L_{box} +  \lambda_{obj} L_{obj} + \lambda_{cls} L_{cls}$</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">lbox</span> <span class="o">*=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hyp</span><span class="p">[</span><span class="s1">&#39;box&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">lobj</span> <span class="o">*=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hyp</span><span class="p">[</span><span class="s1">&#39;obj&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">lcls</span> <span class="o">*=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hyp</span><span class="p">[</span><span class="s1">&#39;cls&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">bs</span> <span class="o">=</span> <span class="n">tobj</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># batch size</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">return</span> <span class="p">(</span><span class="n">lbox</span> <span class="o">+</span> <span class="n">lobj</span> <span class="o">+</span> <span class="n">lcls</span><span class="p">)</span> <span class="o">*</span> <span class="n">bs</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">((</span><span class="n">lbox</span><span class="p">,</span> <span class="n">lobj</span><span class="p">,</span> <span class="n">lcls</span><span class="p">))</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
</ul>

</section>


    <footer class="article-footer">
    
    <section class="article-tags">
        
            <a href="/tags/yolov5/">YOLOv5</a>
        
    </section>


    
    <section class="article-copyright">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <path d="M14.5 9a3.5 4 0 1 0 0 6" />
</svg>



        <span>Licensed under CC BY-NC-SA 4.0</span>
    </section>
    </footer>


    
        <link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css"integrity="sha384-n8MVd4RsNIU0tAv4ct0nTaAbDJwPJzDEaqSD1odI&#43;WdtXRGWt2kTvGFasHpSy3SV"crossorigin="anonymous"
            ><script 
                src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"integrity="sha384-XjKyOOlGwcjNTAIQHIpgOno0Hl1YQqzUOEleOLALmuqehneUG&#43;vnGctmUb0ZY0l8"crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"integrity="sha384-&#43;VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4&#43;/RRE05"crossorigin="anonymous"
                defer
                >
            </script><script>
    window.addEventListener("DOMContentLoaded", () => {
	const mainArticleElement = document.querySelector(".main-article");
        renderMathInElement(mainArticleElement, {
            delimiters: [
                { left: "$$", right: "$$", display: true },
                { left: "$", right: "$", display: false },
                { left: "\\(", right: "\\)", display: false },
                { left: "\\[", right: "\\]", display: true }
            ],
            ignoredClasses: ["gist"]
        });})
</script>

    
</article>

    

    

<aside class="related-content--wrapper">
    <h2 class="section-title">Related content</h2>
    <div class="related-content">
        <div class="flex article-list--tile">
            
                
<article class="">
    <a href="/p/yolov5_val/">
        
        

        <div class="article-details">
            <h2 class="article-title">YOLOv5 Validation</h2>
        </div>
    </a>
</article>

            
                
<article class="">
    <a href="/p/yolov5_augmentation/">
        
        

        <div class="article-details">
            <h2 class="article-title">YOLOv5 Augmentation</h2>
        </div>
    </a>
</article>

            
                
<article class="">
    <a href="/p/yolov5_evolve/">
        
        

        <div class="article-details">
            <h2 class="article-title">YOLOv5 Evolve</h2>
        </div>
    </a>
</article>

            
                
<article class="">
    <a href="/p/yolov5_anchor/">
        
        

        <div class="article-details">
            <h2 class="article-title">YOLOv5 anchor</h2>
        </div>
    </a>
</article>

            
                
<article class="">
    <a href="/p/yolov5_train/">
        
        

        <div class="article-details">
            <h2 class="article-title">YOLOv5 Training</h2>
        </div>
    </a>
</article>

            
        </div>
    </div>
</aside>

     
    
        
    <script src="https://utteranc.es/client.js" 
        repo="kimberlykang/utterances"
        issue-term="pathname"
        
        crossorigin="anonymous"
        async
        >
</script>

<style>
    .utterances {
        max-width: unset;
    }
</style>

<script>
    let utterancesLoaded = false;

    function setUtterancesTheme(theme) {
        let utterances = document.querySelector('.utterances iframe');
        if (utterances) {
            utterances.contentWindow.postMessage(
                {
                    type: 'set-theme',
                    theme: `github-${theme}`
                },
                'https://utteranc.es'
            );
        }
    }

    addEventListener('message', event => {
        if (event.origin !== 'https://utteranc.es') return;

        
        utterancesLoaded = true;
        setUtterancesTheme(document.documentElement.dataset.scheme)
    });

    window.addEventListener('onColorSchemeChange', (e) => {
        if (!utterancesLoaded) return;
        setUtterancesTheme(e.detail)
    })
</script>


    

    <footer class="site-footer">
    <section class="copyright">
        &copy; 
        
            2023 - 
        
        2025 Kimberly&#39;s Blog
    </section>
    
    <section class="powerby">
        Built with <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> <br />
        Theme <b><a href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener" data-version="3.30.0">Stack</a></b> designed by <a href="https://jimmycai.com" target="_blank" rel="noopener">Jimmy</a>
    </section>
</footer>


    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css"crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css"crossorigin="anonymous"
            >

            </main>
        </div>
        <script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js"integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z&#43;KMkF24hUW8WePSA9HM="crossorigin="anonymous"
                
                >
            </script><script type="text/javascript" src="/ts/main.1e9a3bafd846ced4c345d084b355fb8c7bae75701c338f8a1f8a82c780137826.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>

    </body>
</html>
